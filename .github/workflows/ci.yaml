# This file was autogenerated by actions.nix. Do not edit it manually.
# To make changes, edit the workflow definition in your flake's actions-nix configuration
# (typically under flake.actions-nix.workflows.".github/workflows/ci.yaml") and run:
#   nix run .#render-workflows
# Or commit to trigger the pre-commit hook if enabled.
concurrency:
  cancel-in-progress: ${{ github.event_name == 'pull_request' }}
  group: ci-${{ github.head_ref || github.ref_name }}
jobs:
  build:
    name: ${{ matrix.attrs.name }} (${{ matrix.attrs.hostPlatform }})
    runs-on: ${{ matrix.attrs.runsOn }}
    steps:
    - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8
      with:
        persist-credentials: false
    - uses: DeterminateSystems/nix-installer-action@c5a866b6ab867e88becbed4467b93592bce69f8a
      with:
        extra-conf: |-
          accept-flake-config = true
          always-allow-substitutes = true
          builders-use-substitutes = true
          max-jobs = auto
    - uses: actions/cache@8b402f58fbc84540c8b491a91e594a4576fec3d7
      with:
        key: nix-eval-${{ runner.os }}-${{ runner.arch }}-${{ hashFiles('flake.lock')
          }}
        path: ~/.cache/nix
        restore-keys: nix-eval-${{ runner.os }}-${{ runner.arch }}-
    - uses: cachix/cachix-action@0fc020193b5a1fa3ac4575aa3a7d3aa6a35435ad
      with:
        authToken: ${{ secrets.CACHIX_AUTH_TOKEN }}
        name: sinrohit
    - name: "Run Nix CI \U0001F527"
      run: nix build git+file:.#${{ matrix.attrs.attr }}
    strategy:
      fail-fast: false
      matrix:
        attrs:
        - attr: nixosConfigurations.ema.config.system.build.toplevel
          hostPlatform: aarch64-linux
          name: ema
          runsOn: Linux
        - attr: nixosConfigurations.orb.config.system.build.toplevel
          hostPlatform: aarch64-linux
          name: orb
          runsOn: Linux
        - attr: nixosConfigurations.pi.config.system.build.toplevel
          hostPlatform: aarch64-linux
          name: pi
          runsOn: Linux
    timeout-minutes: 60
  build-darwin-host:
    name: ${{ matrix.attrs.name }} (${{ matrix.attrs.hostPlatform }})
    runs-on: ${{ matrix.attrs.runsOn }}
    steps:
    - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8
      with:
        persist-credentials: false
    - uses: DeterminateSystems/nix-installer-action@c5a866b6ab867e88becbed4467b93592bce69f8a
      with:
        extra-conf: |-
          accept-flake-config = true
          always-allow-substitutes = true
          builders-use-substitutes = true
          max-jobs = auto
    - uses: actions/cache@8b402f58fbc84540c8b491a91e594a4576fec3d7
      with:
        key: nix-eval-${{ runner.os }}-${{ runner.arch }}-${{ hashFiles('flake.lock')
          }}
        path: ~/.cache/nix
        restore-keys: nix-eval-${{ runner.os }}-${{ runner.arch }}-
    - uses: cachix/cachix-action@0fc020193b5a1fa3ac4575aa3a7d3aa6a35435ad
      with:
        authToken: ${{ secrets.CACHIX_AUTH_TOKEN }}
        name: sinrohit
    - name: "Run Nix CI \U0001F527"
      run: nix build git+file:.#${{ matrix.attrs.attr }}
    strategy:
      fail-fast: false
      matrix:
        attrs:
        - attr: darwinConfigurations.zion.config.system.build.toplevel
          hostPlatform: aarch64-darwin
          name: zion
          runsOn: macOS
    timeout-minutes: 60
  check:
    if: always()
    needs:
    - flake-check
    - build
    - build-darwin-host
    runs-on: macOS
    steps:
    - uses: re-actors/alls-green@05ac9388f0aebcb5727afa17fcccfecd6f8ec5fe
      with:
        allowed-skips: build-darwin-host
        jobs: ${{ toJSON(needs) }}
    timeout-minutes: 60
  flake-check:
    name: flake check (${{ matrix.systems.platform }})
    runs-on: ${{ matrix.systems.label }}
    steps:
    - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8
      with:
        persist-credentials: false
    - uses: DeterminateSystems/nix-installer-action@c5a866b6ab867e88becbed4467b93592bce69f8a
      with:
        extra-conf: |-
          accept-flake-config = true
          always-allow-substitutes = true
          builders-use-substitutes = true
          max-jobs = auto
    - uses: actions/cache@8b402f58fbc84540c8b491a91e594a4576fec3d7
      with:
        key: nix-eval-${{ runner.os }}-${{ runner.arch }}-${{ hashFiles('flake.lock')
          }}
        path: ~/.cache/nix
        restore-keys: nix-eval-${{ runner.os }}-${{ runner.arch }}-
    - uses: cachix/cachix-action@0fc020193b5a1fa3ac4575aa3a7d3aa6a35435ad
      with:
        authToken: ${{ secrets.CACHIX_AUTH_TOKEN }}
        name: sinrohit
    - name: nix flake check
      run: nix flake check 'git+file:.'
    - name: nix flake show
      run: nix flake show 'git+file:.'
    strategy:
      matrix:
        systems:
        - label: Linux
          platform: aarch64-linux
        - label: macOS
          platform: aarch64-darwin
    timeout-minutes: 60
name: ci
'on':
  pull_request: {}
  push:
    branches:
    - main
  workflow_dispatch: {}
permissions: {}
